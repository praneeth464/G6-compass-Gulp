<!-- ======== ADVANCED SEARCH PAGE ======== -->

<div id="advancedSearchPageView" class="profilePage-liner page-content">

    <!-- Page Body -->
    <div class="row">
        <div class="span12">

            <!-- End Code generated by customFormElements.jsp" -->
            <fieldset class="formSection participantSearchSection" id="addTeamMemberSearch">
                <h2>Search Team Members

                    <span class="validateme hiddenValidationInput" data-validate-flags="nonempty" data-validate-fail-msgs='{"nonempty" : "You must add at least one team member."}'>
                        <input type="text" class="hiddenValidationInput hidden" id="teamMembersCount" name="teamMembersCount" value="" readonly>
                    </span>
                </h2>
                <!--
                    Participant search view Element
                    - data-search-types: defines the dropdowns and autocompletes
                    - data-search-params: defines extra static parameters to send with autocomp and participant requests
                    - data-autocomp-delay: how long to wait after key entry to query server
                    - data-autocomp-min-chars: min num chars before querying server
                    - data-search-url: override search json provider (usually needed)
                    - data-select-mode: 'single' OR 'multiple' select behavior
                    - data-msg-select-txt: link to select (optional)
                    - data-msg-selected-txt: text to show something is selected (optional)
                -->

                <div id="addTeamMembersWrap">

                    <div id="participantSearchView"
                         data-search-types='[{"id":"lastName","name":"Last Name"},{"id":"firstName","name":"First Name"},{"id":"location","name":"Location"},{"id":"jobTitle","name":"Job Title"},{"id":"department","name":"Department"},{"id":"country","name":"Country"}]'
                         data-search-params='{"promotionId":"thisShouldBeSetAlready","nodeId":"extraValue"}'
                         data-autocomp-delay="500"
                         data-autocomp-min-chars="3"
                         data-autocomp-url="ajax/participantSearch_autocomp_firstName.json"
                         data-search-url="ajax/participantGlobalSearchResults.json"
                         data-select-mode="single"
                         data-msg-select-txt="View Profile"
                         data-msg-selected-txt="<i class='icon icon-ok'></i>"
                         data-msg-validation="You must add a recipient."
                         data-visibility-controls="showAndHide"
                         data-msg-show-single="Change Team Member"
                         data-msg-show="Select Participant"
                         data-msg-hide="Done Adding">

                        <!-- added by view -->
                    </div>
                </div><!-- /#addTeamMembersWrap -->
            </fieldset><!-- /#addTeamMemberSearch -->

        </div>
    </div><!-- /.row -->
</div><!-- /#advancedSearchPageView -->

<script id="teamMemberRowTpl" type="text/x-handlebars-template">
    <tr class="participant-item"
    data-participant-cid="{{cid}}"
    data-participant-id="{{id}}">

        <td class="participant">
            <input type="hidden" name="pax[{{autoIndex}}].userId" value="{{id}}" />

            <a class="participant-popover" href="#" data-participant-ids="[{{id}}]">
            {{lastName}}, {{firstName}}
            </a>
        </td>

        <td class="remove">
            <a class="remParticipantControl" title="remove this participant"><i class="icon-remove"></i></a>
        </td>
   </tr><!-- /.participant-item -->
</script>

<script type="text/template" id="recipientListTtl">
    <ul id="ezRecipListWrapper">
    {{#each this}}
        <li class="moduleRecipWrapper" data-tabindex="{{this.index}}" data-recipientId="{{this.id}}" data-recipientNodeId="{{this.nodeId}}">
            <h1>{{this.firstName}} {{this.lastName}}</h1>
            <h2>{{this.orgName}}</h2>
            <h3>{{#if this.departmentName}}{{this.departmentName}}, {{/if}}{{this.jobName}}</h3>
        </li>
    {{else}}
        <li>
            No results
        </li>
    {{/each}}
    </ul>
</script>

<!-- Instantiate the PageView - this goes here as it expresses the DOM element the PageView is getting attached to -->
<script>
    $(document).ready(function() {
        // BOOTSTRAPPED JSON DATA - render this dynamically in the JSP
        // JSON object with valid nodes and promotion + form setup for each promo
        // JAVA/JSP: generate this array of 'form setups' for different promos

        //attach the view to an existing DOM element
        window.gpsv = new ParticipantProfileSearchPageView ({
            el: $('#advancedSearchPageView'),
            formSetup: '',
            userRole: 'manager', // 'manager' or 'participant'
            pageNav: {
                back: {
                    text: 'Back',
                    url: 'layout.html'
                },
                home: {
                    text: 'Home',
                    url: 'layout.html'
                }
            },
            pageTitle: 'Profile Advanced Search'
        });

    });
</script>